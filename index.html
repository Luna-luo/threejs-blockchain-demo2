<html>
    <head>
        <meta charset="utf-8">
        <title>three.js Tween.js Example</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            html, body {
                height: 100%;
                margin: 0;
            }
        </style>
<!--        <script src="https://code.createjs.com/1.0.0/tweenjs.min.js"></script>-->
    </head>
    <body>
    <!--        <canvas id="c"></canvas>-->
<!--        <div id="info"></div>-->
<!--        <script type="module" src="js/door.js"></script>-->
        <script type="module" >
          import * as THREE from './build/three.module.js';
          import {BufferGeometryUtils} from './jsm/utils/BufferGeometryUtils.js';
          import { OrbitControls } from './jsm/controls/OrbitControls.js';

          let SCREEN_WIDTH = window.innerWidth;
          let SCREEN_HEIGHT = window.innerHeight;
          let aspect = SCREEN_WIDTH / SCREEN_HEIGHT;
          let group, camera, scene, renderer, mesh;

          scene = new THREE.Scene();
          scene.background = new THREE.Color(0xebebeb);
          camera = new THREE.PerspectiveCamera( 60, aspect, 0.1, 1000 );
          camera.position.set(-10,10,50)

          renderer = new THREE.WebGLRenderer({antialias: true,});
          renderer.setSize( window.innerWidth, window.innerHeight);
          document.body.appendChild(renderer.domElement);

          scene.add( new THREE.AxesHelper( 20 ) )

          const controls = new OrbitControls( camera, renderer.domElement)
          const loader = new THREE.TextureLoader();
          const texture = loader.load( 'textures/aa.png' );
          // const texture2 = loader.load( 'textures/scalepoint.png' );
          const clock = new THREE.Clock();

          const light = new THREE.AmbientLight(0x404040);
          scene.add(light)


          //小块 block组
          const objects = [];

          const blockGeometry = new THREE.BoxGeometry(3,3,3);

          const block = new THREE.Object3D();
          block.position.set(0,-20,0)
          scene.add(block)
          objects.push(block)

          const frameblockMaterial = new THREE.LineBasicMaterial({color:0x0289AC});
          // const frameblockMaterial = new THREE.MeshBasicMaterial({color:0x0289AC, wireframe:true });
          // const frameblock = new THREE.Mesh(blockGeometry,frameblockMaterial);
          const edges = new THREE.EdgesGeometry(blockGeometry)
          const frameblock = new THREE.LineSegments(edges,frameblockMaterial);
          frameblock.scale.set(1.3,1.3,1.3)
          block.add(frameblock)
          objects.push(frameblock)

          const innerblockMaterial = new THREE.MeshBasicMaterial({color:0x0289AC});
          const innerblock = new THREE.Mesh(blockGeometry,innerblockMaterial);
          block.add(innerblock)
          objects.push(innerblock)

          //球 earth组
          const earth = new THREE.Object3D()
          scene.add(earth)
          const earthObjects = []

          // let earthGeometry = new THREE.SphereGeometry(12,12,12)
          let earthGeometry = new THREE.DodecahedronGeometry(12,1)
          earthGeometry.deleteAttribute( 'normal' );
          earthGeometry.deleteAttribute( 'uv' );

          earthGeometry = BufferGeometryUtils.mergeVertices(earthGeometry)

          const vertices = [];
          const positionAttribute = earthGeometry.getAttribute( 'position' );

          for ( let i = 0; i < positionAttribute.count; i ++ ) {
            const vertex = new THREE.Vector3();
            vertex.fromBufferAttribute( positionAttribute, i );
            vertices.push( vertex );
          }

          const pointsMaterial = new THREE.PointsMaterial({
            color: 0x01fcff,
            map: texture,
            size: 1,
            alphaTest: 0.5
          })
          const pointsGeometry = new THREE.BufferGeometry().setFromPoints( vertices );
          const points = new THREE.Points( pointsGeometry, pointsMaterial );
          earth.add( points )

          const earthEdges = new THREE.EdgesGeometry(earthGeometry)
          const earthMesh = new THREE.Mesh( earthGeometry, new THREE.MeshBasicMaterial({ color: 0x0289AC, wireframe: true}) )
          // const earthMesh = new THREE.LineSegments( earthEdges, new THREE.MeshBasicMaterial({ color: 0x0289AC}) )
          earth.add(earthMesh)

          //线组
          const arrowMesh = new THREE.Object3D()
          arrowMesh.position.set(-10,-10,20)
          arrowMesh.add(new THREE.AxisHelper(20))
          scene.add(arrowMesh)

          const length = 5;
          const hex = 0x01fcff;
          const arrowArrayOrigin = [[]]//todo
          for(let i = 0;i <= 10;i++){
            let origin = new THREE.Vector3().random().multiplyScalar(10);
            let dir = origin.clone().add(new THREE.Vector3(origin.x,origin.y*2,origin.z))

            const arrowHelper = new THREE.ArrowHelper( dir, origin, length, hex );
            arrowMesh.add( arrowHelper );
          }



          //animation
          const times = [0,2];
          const liftValues = [-40, 0];
          const liftTrack1 = new THREE.KeyframeTrack(
            'block.position[y]',
            times,
            liftValues
          );
          const liftTrack2 = new THREE.KeyframeTrack(
            'block.position[y]',
            [4,6],
            [0,40]
          );
          const duration = 10;
          const clip = new THREE.AnimationClip('lift',duration,[liftTrack1, liftTrack2]);

          const mixer = new THREE.AnimationMixer(block);//??new THREE.AnimationMixer(scene)??
          const AnimationAction = mixer.clipAction(clip);
          AnimationAction.setLoop(THREE.LoopOnce);
          AnimationAction.clampWhenFinished = true;
          AnimationAction.enabled = true;
          AnimationAction.play();




          const animate = function(){
            requestAnimationFrame(animate);
            // earth.rotation.z -= 0.03;

            renderer.render(scene, camera);
            mixer.update(clock.getDelta());

          }

          animate();


        </script>
    </body>
</html>
